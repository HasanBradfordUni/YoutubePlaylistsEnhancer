<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playlist Search</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .search-container {
      text-align: center;
      padding: 20px;
    }

    .results-container {
      margin-top: 20px;
    }

    .playlist {
      border: 1px solid #ddd;
      margin: 10px;
      padding: 10px;
    }
  </style>
</head>

<body>
  <!-- This is a comment-->
  <div class="search-container">
    <h1>Search for YouTube Playlists</h1>
    <input type="text" id="searchQuery" placeholder="Enter search term...">
    <button onclick="displaySearchResults()">Search</button><br><br>
  </div>

  <div id="results" class="results-container">
    <!-- Search results will be displayed here -->
  </div>

  <script type="module">
    import { API_KEY } from './config.template.js';
    export async function searchPlaylists(searchTerm, pageToken = '', playlistResults = []) {
      try {
        const apiKey = API_KEY;
      } catch (error) { console.log(error) }

      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=25&q=${searchTerm}&type=playlist&key=${apiKey}`;

      console.log('Searching for:', searchTerm);

      // Display a placeholder for search results
      document.getElementById('results').innerHTML = '<div class="playlists">Search results for "' + searchTerm + '" will be displayed here.</div>';

      try {
        const response = await fetch(url);
        const data = await response.json();

        // Process the data.items array
        data.items.forEach(item => {
          console.log(item.snippet); // Log the title of each video
          playlistResults.push(item.snippet);
        });

        // Check if there are more pages
        if (data.nextPageToken) {
          return searchPlaylists(searchTerm, data.nextPageToken, playlistResults);
        } else {
          return playlistResults; // No more pages, return the final list of playlist results
        }
      } catch (error) {
        console.error('Error fetching data: ', error);
        return playlistResults; // Return the playlist results fetched so far in case of error
      }
    }
  </script>

  <script>
    async function displaySearchResults() {
      var searchTerm = document.getElementById('searchQuery').value;
      try {
        const playlistResults = await searchPlaylists(searchTerm, '', []);
        console.log(playlistResults);
      } catch (error) {
        console.log(error)
      }

      var paragraph = document.getElementById('playlists');

      // Clear the paragraph content
      paragraph.innerHTML = '';

      // Iterate over the array and append each element to the paragraph
      playlistResults.forEach(function (element) {
        // Create a text node for each element
        var textNode = document.createTextNode(element);

        // Append the text node to the paragraph
        paragraph.appendChild(textNode);
        paragraph.appendChild(document.createElement('br'));
      });
    }

  </script>

</body>

</html>
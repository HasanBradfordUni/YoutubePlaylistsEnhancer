<!DOCTYPE html>
<html>

<head>
  <title>Has Youtube Playlists Enhancer</title>
  <meta charset="utf-8" />
</head>

<body>
  <p>Has Youtube Playlists Enhancer</p>
  <button id="fetch-videos">Fetch Playlist Videos</button>
  <p id="videoslist"></p>

  <script>
    function getPlaylistID() {
      var match, playList_ID, playlist_url;
      playlist_url = "https://www.youtube.com/playlist?list=PLsyeobzWxl7poL9JTVyndKe62ieoN-MZ3";

      let regex = /list=([a-zA-Z0-9_-]+)/;
      match = playlist_url.match(regex);

      if (match) {
        playList_ID = match[1];
        console.log("Playlist ID:", playList_ID);
      } else {
        console.log("Could not extract playlist ID.");
      }
      return playList_ID;
    }


    // Replace 'YOUR_API_KEY' with your actual API key
    const apiKey = 'AIzaSyBirpEydenGZDoSY4ED0lXGmD0F57y6C9o';

    function fetchPlaylistVideos(playlistId, pageToken, videos, index) {
      var videos = [];
      let url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${apiKey}`;
      if (pageToken) {
        url += `&pageToken=${pageToken}`;
      }
      fetch(url)
        .then(response => response.json())
        .then(data => {
          // Process the data.items array
          data.items.forEach(item => {
            console.log(item.snippet.title); // Log the title of each video
            videos.push(item); // Add the video item to the videos array
          });

          // Check if there are more pages
          if (data.nextPageToken) {
            fetchPlaylistVideos(playlistId, data.nextPageToken, callback);
          } else {
            // If no more pages, call the callback function
            callback(videos);
          }
        })
        .catch(error => {
          console.error('Error fetching data: ', error);
          callback([]); // Call the callback with an empty array in case of error
        });
    }

    document.getElementById('fetch-videos').addEventListener('click', function () {
      var playlistId = getPlaylistID();

      // Define a callback function to update the UI
      var updateUI = function (videos) {
        document.getElementById('videosList').innerHTML = videos.map(video => video.snippet.title).join('<br>');
      };

      // Pass the callback function to fetchPlaylistVideos
      fetchPlaylistVideos(playlistId, updateUI);
    });

  </script>
</body>

</html>